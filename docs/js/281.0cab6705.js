"use strict";(self["webpackChunkquanxiang"]=self["webpackChunkquanxiang"]||[]).push([[281],{1166:function(e,l){const i=(e,l)=>{for(let t of e){var i=new Date(t[l]).toJSON();t[l]=new Date(+new Date(i)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"")}return e};l.Z=i},9281:function(e,l,i){i.r(l),i.d(l,{default:function(){return n}});var t=i(3396);const a=(0,t._)("span",{style:{"vertical-align":"middle"}}," 添加权限 ",-1),s={class:"dialog-footer"},o={class:"dialog-footer"};function d(e,l,i,d,r,u){const m=(0,t.up)("el-breadcrumb-item"),p=(0,t.up)("el-breadcrumb"),n=(0,t.up)("Plus"),c=(0,t.up)("el-icon"),f=(0,t.up)("el-button"),w=(0,t.up)("el-row"),g=(0,t.up)("el-table-column"),h=(0,t.up)("el-tag"),b=(0,t.up)("Edit"),W=(0,t.up)("el-tooltip"),_=(0,t.up)("Delete"),k=(0,t.up)("el-table"),V=(0,t.up)("el-card"),y=(0,t.up)("el-input"),U=(0,t.up)("el-form-item"),D=(0,t.up)("el-option"),F=(0,t.up)("el-select"),C=(0,t.up)("el-form"),$=(0,t.up)("el-dialog");return(0,t.wg)(),(0,t.iD)("div",null,[(0,t.Wm)(p,{separator:"/"},{default:(0,t.w5)((()=>[(0,t.Wm)(m,{to:{path:"/home"}},{default:(0,t.w5)((()=>[(0,t.Uk)("首页")])),_:1}),(0,t.Wm)(m,null,{default:(0,t.w5)((()=>[(0,t.Uk)("权限管理")])),_:1})])),_:1}),(0,t.Wm)(V,null,{default:(0,t.w5)((()=>[(0,t.Wm)(w,null,{default:(0,t.w5)((()=>[(0,t.Wm)(f,{type:"primary",onClick:l[0]||(l[0]=e=>r.addDialogVisible=!0)},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Wm)(n)])),_:1}),a])),_:1})])),_:1}),(0,t.Wm)(k,{data:r.rightsList,style:{width:"100%"},border:"",stripe:""},{default:(0,t.w5)((()=>[(0,t.Wm)(g,{type:"index",label:"#"}),(0,t.Wm)(g,{prop:"description",label:"权限名称",width:"100"}),(0,t.Wm)(g,{prop:"url",label:"路径"}),(0,t.Wm)(g,{prop:"type",label:"类别",width:"100"}),(0,t.Wm)(g,{prop:"level",label:"权限等级",width:"85"},{default:(0,t.w5)((e=>[1===e.row.hasChildren?((0,t.wg)(),(0,t.j4)(h,{key:0,effect:"plain"},{default:(0,t.w5)((()=>[(0,t.Uk)("一级")])),_:1})):((0,t.wg)(),(0,t.j4)(h,{key:1,effect:"plain",type:"success"},{default:(0,t.w5)((()=>[(0,t.Uk)("二级")])),_:1}))])),_:1}),(0,t.Wm)(g,{prop:"pid",label:"父级权限",width:"95",align:"center"},{default:(0,t.w5)((e=>[8===e.row.pid?((0,t.wg)(),(0,t.j4)(h,{key:0,effect:"plain"},{default:(0,t.w5)((()=>[(0,t.Uk)("学校管理")])),_:1})):(0,t.kq)("",!0),6===e.row.pid?((0,t.wg)(),(0,t.j4)(h,{key:1,effect:"plain"},{default:(0,t.w5)((()=>[(0,t.Uk)("专业管理")])),_:1})):(0,t.kq)("",!0),36===e.row.pid?((0,t.wg)(),(0,t.j4)(h,{key:2,effect:"plain"},{default:(0,t.w5)((()=>[(0,t.Uk)("用户管理")])),_:1})):(0,t.kq)("",!0),35===e.row.pid?((0,t.wg)(),(0,t.j4)(h,{key:3,effect:"plain"},{default:(0,t.w5)((()=>[(0,t.Uk)("api管理")])),_:1})):(0,t.kq)("",!0),34===e.row.pid?((0,t.wg)(),(0,t.j4)(h,{key:4,effect:"plain"},{default:(0,t.w5)((()=>[(0,t.Uk)("内容管理")])),_:1})):(0,t.kq)("",!0),0===e.row.pid?((0,t.wg)(),(0,t.j4)(h,{key:5,effect:"plain",type:"success"},{default:(0,t.w5)((()=>[(0,t.Uk)("无")])),_:1})):(0,t.kq)("",!0)])),_:1}),(0,t.Wm)(g,{prop:"createTime",label:"创建时间"}),(0,t.Wm)(g,{label:"操作",width:"140"},{default:(0,t.w5)((e=>[(0,t.Wm)(W,{content:"修改权限",placement:"top"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{type:"primary",onClick:l=>u.showEditDialog(e.row.id)},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Wm)(b)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),(0,t.Wm)(W,{content:"删除权限",placement:"top"},{default:(0,t.w5)((()=>[(0,t.Wm)(f,{type:"danger",onClick:l=>u.removePermission(e.row.id)},{default:(0,t.w5)((()=>[(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Wm)(_)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"])])),_:1}),(0,t.Wm)($,{modelValue:r.addDialogVisible,"onUpdate:modelValue":l[6]||(l[6]=e=>r.addDialogVisible=e),title:"添加新权限",width:"40%",onClose:u.addDialogClosed},{footer:(0,t.w5)((()=>[(0,t._)("span",s,[(0,t.Wm)(f,{onClick:l[5]||(l[5]=e=>r.addDialogVisible=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(f,{type:"primary",onClick:u.addPermission},{default:(0,t.w5)((()=>[(0,t.Uk)(" 确定 ")])),_:1},8,["onClick"])])])),default:(0,t.w5)((()=>[(0,t.Wm)(C,{ref:"addFormRef",model:r.permission,rules:r.FormRules,"label-width":"80px"},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{label:"权限名称",prop:"description"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{modelValue:r.permission.description,"onUpdate:modelValue":l[1]||(l[1]=e=>r.permission.description=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(U,{label:"父级权限",prop:"pid"},{default:(0,t.w5)((()=>[(0,t.Wm)(F,{modelValue:r.permission.pid,"onUpdate:modelValue":l[2]||(l[2]=e=>r.permission.pid=e),placeholder:"请选择父级权限"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(r.rightsList,(e=>((0,t.wg)(),(0,t.j4)(D,{key:e.id,label:e.description,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(U,{label:"类别",prop:"type"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{modelValue:r.permission.type,"onUpdate:modelValue":l[3]||(l[3]=e=>r.permission.type=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(U,{label:"路径",prop:"url"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{modelValue:r.permission.url,"onUpdate:modelValue":l[4]||(l[4]=e=>r.permission.url=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"]),(0,t.Wm)($,{modelValue:r.editDialogVisible,"onUpdate:modelValue":l[12]||(l[12]=e=>r.editDialogVisible=e),title:"修改用户信息",width:"40%"},{footer:(0,t.w5)((()=>[(0,t._)("span",o,[(0,t.Wm)(f,{onClick:l[11]||(l[11]=e=>r.editDialogVisible=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(f,{type:"primary",onClick:u.editPermission},{default:(0,t.w5)((()=>[(0,t.Uk)(" 确定 ")])),_:1},8,["onClick"])])])),default:(0,t.w5)((()=>[(0,t.Wm)(C,{ref:"editFormRef",model:r.editForm,rules:r.FormRules,"label-width":"80px"},{default:(0,t.w5)((()=>[(0,t.Wm)(U,{label:"权限名称",prop:"description"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{modelValue:r.editForm.description,"onUpdate:modelValue":l[7]||(l[7]=e=>r.editForm.description=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(U,{label:"父级权限",prop:"pid"},{default:(0,t.w5)((()=>[(0,t.Wm)(F,{modelValue:r.editForm.pid,"onUpdate:modelValue":l[8]||(l[8]=e=>r.editForm.pid=e),clearable:"",placeholder:"请选择父级权限"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(r.rightsList,(e=>((0,t.wg)(),(0,t.j4)(D,{key:e.id,label:e.description,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,t.Wm)(U,{label:"类别",prop:"type"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{modelValue:r.editForm.type,"onUpdate:modelValue":l[9]||(l[9]=e=>r.editForm.type=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(U,{label:"路径",prop:"url"},{default:(0,t.w5)((()=>[(0,t.Wm)(y,{modelValue:r.editForm.url,"onUpdate:modelValue":l[10]||(l[10]=e=>r.editForm.url=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}var r=i(1166),u={data(){return{rightsList:[],permission:{code:"",createTime:"",deleted:0,description:"",hasChildren:1,id:0,pid:0,type:"",updateTime:"",url:""},editForm:{},addDialogVisible:!1,editDialogVisible:!1,FormRules:{description:[{required:!0,message:"请输入权限名称",trigger:"blur"}],pid:[{required:!0,message:"请输入父级默认0是顶级管理",trigger:"blur"}],type:[{required:!0,message:"请输入类别",trigger:"blur"}],url:[{required:!0,message:"请输入路径",trigger:"blur"}]}}},created(){this.getRightsList()},methods:{async getRightsList(){const{data:e}=await this.$http.get("/api/permission/all");if(console.log(e),!e.success)return this.$message.error("获取权限列表失败！");(0,r.Z)(e.data.permissions,"createTime"),this.rightsList=e.data.permissions},async showEditDialog(e){const{data:l}=await this.$http.get("/api/permission/one",{params:{id:e}});if(console.log(e),!l.success)return this.$message.error("查询权限信息失败!");console.log(l.data.permission),this.editForm=l.data.permission,this.editDialogVisible=!0},addPermission(){this.$refs.addFormRef.validate((async e=>{if(!e)return!1;const l=Math.floor(1e5*Math.random())+1,i=Math.floor(1e3*Math.random())+1;this.permission.id=l,this.permission.code=i;const{data:t}=await this.$http.post("/api/permission/add",this.permission);if(console.log(t,this.permission),!t.success)return this.$message.error("添加权限失败！");this.addDialogVisible=!1,this.getRightsList(),this.$message.success("添加权限成功！")}))},addDialogClosed(){this.$refs.addFormRef.resetFields()},editPermission(){this.$refs.editFormRef.validate((async e=>{if(!e)return!1;const{data:l}=await this.$http.post("/api/permission/edit",this.editForm);if(!l.success)return this.$message.error("修改用户信息失败！");this.editDialogVisible=!1,this.getRightsList(),this.$message.success("修改用户信息成功！")}))},async removePermission(e){const l=await this.$confirm("是否永久删除该权限?","删除权限",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((e=>e));if("confirm"!==l)return this.$message.info("取消删除");const{data:i}=await this.$http.get("/api/permission/delete",{params:{id:e}});if(console.log(i),!i.success)return this.$message.error(i.msg);this.getRightsList(),this.$message.success("删除权限成功")}}},m=i(89);const p=(0,m.Z)(u,[["render",d]]);var n=p}}]);
//# sourceMappingURL=281.0cab6705.js.map