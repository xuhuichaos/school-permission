"use strict";(self["webpackChunkquanxiang"]=self["webpackChunkquanxiang"]||[]).push([[491],{1166:function(e,l){const t=(e,l)=>{for(let i of e){var t=new Date(i[l]).toJSON();i[l]=new Date(+new Date(t)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"")}return e};l.Z=t},3491:function(e,l,t){t.r(l),t.d(l,{default:function(){return p}});var i=t(3396);const o=(0,i._)("span",{style:{"vertical-align":"middle"}}," 添加角色 ",-1),s={class:"dialog-footer"},a={class:"dialog-footer"},r={class:"dialog-footer"};function d(e,l,t,d,n,m){const u=(0,i.up)("el-breadcrumb-item"),c=(0,i.up)("el-breadcrumb"),p=(0,i.up)("Plus"),g=(0,i.up)("el-icon"),h=(0,i.up)("el-button"),f=(0,i.up)("el-row"),w=(0,i.up)("el-table-column"),W=(0,i.up)("CircleCheck"),b=(0,i.up)("CircleClose"),_=(0,i.up)("Edit"),V=(0,i.up)("el-tooltip"),y=(0,i.up)("Delete"),k=(0,i.up)("Finished"),R=(0,i.up)("el-table"),C=(0,i.up)("el-card"),D=(0,i.up)("el-input"),$=(0,i.up)("el-form-item"),F=(0,i.up)("el-form"),v=(0,i.up)("el-dialog"),U=(0,i.up)("el-option"),P=(0,i.up)("el-select"),x=(0,i.up)("el-tree");return(0,i.wg)(),(0,i.iD)("div",null,[(0,i.Wm)(c,{separator:"/"},{default:(0,i.w5)((()=>[(0,i.Wm)(u,{to:{path:"/home"}},{default:(0,i.w5)((()=>[(0,i.Uk)("首页")])),_:1}),(0,i.Wm)(u,null,{default:(0,i.w5)((()=>[(0,i.Uk)("角色管理")])),_:1})])),_:1}),(0,i.Wm)(C,{class:"box-card"},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i.Wm)(h,{type:"primary",onClick:l[0]||(l[0]=e=>n.addDialogVisible=!0)},{default:(0,i.w5)((()=>[(0,i.Wm)(g,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p)])),_:1}),o])),_:1})])),_:1}),(0,i.Wm)(R,{data:n.roleList,style:{width:"100%"},border:"",stripe:""},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{type:"expand"}),(0,i.Wm)(w,{type:"index",label:"#"}),(0,i.Wm)(w,{prop:"roleName",label:"角色",width:"180"}),(0,i.Wm)(w,{prop:"description",label:"描述",width:"180"}),(0,i.Wm)(w,{prop:"status",label:"状态",width:"80"},{default:(0,i.w5)((e=>[(0,i._)("div",null,[1==e.row.status?((0,i.wg)(),(0,i.j4)(g,{key:0,style:{color:"#67c23a"}},{default:(0,i.w5)((()=>[(0,i.Wm)(W)])),_:1})):((0,i.wg)(),(0,i.j4)(g,{key:1,style:{color:"#f56c6c"}},{default:(0,i.w5)((()=>[(0,i.Wm)(b)])),_:1}))])])),_:1}),(0,i.Wm)(w,{prop:"createTime",label:"注册时间",width:"180"}),(0,i.Wm)(w,{label:"操作"},{default:(0,i.w5)((e=>[(0,i.Wm)(V,{content:"修改角色",placement:"top"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{type:"primary",size:"default",onClick:l=>m.showEditDialog(e.row.id)},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{style:{"vertical-align":"middle"}},{default:(0,i.w5)((()=>[(0,i.Wm)(_)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),(0,i.Wm)(V,{content:"删除角色",placement:"top"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{type:"danger",onClick:l=>m.removeRole(e.row.id)},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{style:{"vertical-align":"middle"}},{default:(0,i.w5)((()=>[(0,i.Wm)(y)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),(0,i.Wm)(V,{content:"分配权限",placement:"top"},{default:(0,i.w5)((()=>[(0,i.Wm)(h,{type:"warning",onClick:l=>m.showRightDialog(e.row.id)},{default:(0,i.w5)((()=>[(0,i.Wm)(g,{style:{"vertical-align":"middle"}},{default:(0,i.w5)((()=>[(0,i.Wm)(k)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"])])),_:1}),(0,i.Wm)(v,{modelValue:n.addDialogVisible,"onUpdate:modelValue":l[4]||(l[4]=e=>n.addDialogVisible=e),title:"添加新角色",width:"40%",onClose:m.addDialogClosed},{footer:(0,i.w5)((()=>[(0,i._)("span",s,[(0,i.Wm)(h,{onClick:l[3]||(l[3]=e=>n.addDialogVisible=!1)},{default:(0,i.w5)((()=>[(0,i.Uk)("取消")])),_:1}),(0,i.Wm)(h,{type:"primary",onClick:m.addRole},{default:(0,i.w5)((()=>[(0,i.Uk)(" 确定 ")])),_:1},8,["onClick"])])])),default:(0,i.w5)((()=>[(0,i.Wm)(F,{ref:"addFormRef",model:n.role,rules:n.addFormRules,"label-width":"80px"},{default:(0,i.w5)((()=>[(0,i.Wm)($,{label:"角色名称",prop:"roleName"},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{modelValue:n.role.roleName,"onUpdate:modelValue":l[1]||(l[1]=e=>n.role.roleName=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)($,{label:"角色描述",prop:"description"},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{modelValue:n.role.description,"onUpdate:modelValue":l[2]||(l[2]=e=>n.role.description=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"]),(0,i.Wm)(v,{modelValue:n.editDialogVisible,"onUpdate:modelValue":l[9]||(l[9]=e=>n.editDialogVisible=e),title:"修改角色信息",width:"40%"},{footer:(0,i.w5)((()=>[(0,i._)("span",a,[(0,i.Wm)(h,{onClick:l[8]||(l[8]=e=>n.editDialogVisible=!1)},{default:(0,i.w5)((()=>[(0,i.Uk)("取消")])),_:1}),(0,i.Wm)(h,{type:"primary",onClick:m.editRole},{default:(0,i.w5)((()=>[(0,i.Uk)(" 确定 ")])),_:1},8,["onClick"])])])),default:(0,i.w5)((()=>[(0,i.Wm)(F,{ref:"editFormRef",model:n.editForm,rules:n.editFormRules,"label-width":"80px"},{default:(0,i.w5)((()=>[(0,i.Wm)($,{label:"角色名称",prop:"roleName"},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{modelValue:n.editForm.roleName,"onUpdate:modelValue":l[5]||(l[5]=e=>n.editForm.roleName=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)($,{label:"角色描述",prop:"description"},{default:(0,i.w5)((()=>[(0,i.Wm)(D,{modelValue:n.editForm.description,"onUpdate:modelValue":l[6]||(l[6]=e=>n.editForm.description=e)},null,8,["modelValue"])])),_:1}),(0,i.Wm)($,{label:"角色状态"},{default:(0,i.w5)((()=>[(0,i.Wm)(P,{modelValue:n.editForm.status,"onUpdate:modelValue":l[7]||(l[7]=e=>n.editForm.status=e),class:"m-2",size:"large"},{default:(0,i.w5)((()=>[(0,i.Wm)(U,{label:"启用",value:1}),(0,i.Wm)(U,{label:"禁用",value:0})])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"]),(0,i.Wm)(v,{modelValue:n.ShowRightDialogVisible,"onUpdate:modelValue":l[11]||(l[11]=e=>n.ShowRightDialogVisible=e),onClose:m.rightDialogClosed,title:"分配权限",width:"40%"},{footer:(0,i.w5)((()=>[(0,i._)("span",r,[(0,i.Wm)(h,{onClick:l[10]||(l[10]=e=>n.ShowRightDialogVisible=!1)},{default:(0,i.w5)((()=>[(0,i.Uk)("取消")])),_:1}),(0,i.Wm)(h,{type:"primary",onClick:m.assignmentRight},{default:(0,i.w5)((()=>[(0,i.Uk)(" 确定 ")])),_:1},8,["onClick"])])])),default:(0,i.w5)((()=>[(0,i.Wm)(x,{data:n.rightList,props:n.defaultProps,"node-key":"id","show-checkbox":"","default-expand-all":"","default-checked-keys":n.defKeys,ref:"treeRef"},null,8,["data","props","default-checked-keys"])])),_:1},8,["modelValue","onClose"])])}var n=t(1166),m={data(){return{roleList:[],rightList:[],rolePermissions:[],role:{createTime:"",deleted:0,description:"",id:0,roleName:"",status:0,updateTime:""},editForm:{},addDialogVisible:!1,editDialogVisible:!1,ShowRightDialogVisible:!1,addFormRules:{roleName:[{required:!0,message:"请输入角色名",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}]},editFormRules:{roleName:[{required:!0,message:"请输入角色名",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}]},defaultProps:{children:"childern",label:"description"},defKeys:[],roleId:""}},created(){this.getRoles(),this.getRolePermission()},methods:{async getRoles(){const{data:e}=await this.$http.get("/api/role/all");if(!e.success)return this.$message.error("获取角色列表失败!");const l=e.data.roles;(0,n.Z)(l,"createTime"),this.roleList=l,console.log(this.roleList)},async getRolePermission(){const{data:e}=await this.$http.get("/api/rolePermission/all");if(console.log(e),!e.success)return this.$message.error("获取角色权限列表失败!");const l=e.data.rolePermissions;this.rolePermissions=l,console.log(this.rolePermissions)},async showEditDialog(e){const{data:l}=await this.$http.get("/api/role/one",{params:{id:e}});if(console.log(e),!l.success)return this.$message.error("查询角色信息失败!");console.log(l.data.role),this.editForm=l.data.role,this.editDialogVisible=!0},addRole(){this.$refs.addFormRef.validate((async e=>{if(!e)return!1;const{data:l}=await this.$http.post("/api/role/add",this.role);if(console.log(l),!l.success)return this.$message.error("添加角色权限失败！");this.addDialogVisible=!1,this.getRoles(),this.$message.success("添加角色权限成功！")}))},editRole(){this.$refs.editFormRef.validate((async e=>{if(!e)return!1;const{data:l}=await this.$http.post("/api/role/edit",this.editForm);if(!l.success)return this.$message.error("修改角色信息失败！");this.editDialogVisible=!1,this.getRoles(),this.$message.success("修改角色信息成功！")}))},async removeRole(e){const l=await this.$confirm("是否永久删除该角色?","删除角色",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((e=>e));if("confirm"!==l)return this.$message.info("取消删除");const{data:t}=await this.$http.get("/api/role/delete",{params:{id:e}});if(console.log(t),!t.success)return this.$message.error(t.msg);this.getRoles(),this.$message.success(t.msg)},showRightDialog(e){this.roleId=e;const l=this.rolePermissions.findIndex((l=>l.roleId==e));this.$http.get("/api/permission/tree").then((e=>{this.rightList=e.data.data.tree,console.log(l),-1!=l&&(this.defKeys=this.rolePermissions[l].permissionIds.split(","),console.log(this.defKeys))})),this.ShowRightDialogVisible=!0},addDialogClosed(){this.$refs.addFormRef.resetFields()},rightDialogClosed(){this.defKeys=[]},async assignmentRight(){const e=[...this.$refs.treeRef.getCheckedKeys(),...this.$refs.treeRef.getHalfCheckedNodes()];console.log(e.join());const{data:l}=await this.$http.post("/api/rolePermission/edit",{createTime:"",id:0,permissionIds:e.join(),roleId:this.roleId,updateTime:""});if(console.log(l),!l.success)return this.$message.error("分配权限失败");this.$message.success("分配权限成功"),this.getRoles(),this.getRolePermission(),this.ShowRightDialogVisible=!1}}},u=t(89);const c=(0,u.Z)(m,[["render",d]]);var p=c}}]);
//# sourceMappingURL=491.7fd7b28f.js.map