"use strict";(self["webpackChunkquanxiang"]=self["webpackChunkquanxiang"]||[]).push([[69],{1166:function(e,l){const s=(e,l)=>{for(let t of e){var s=new Date(t[l]).toJSON();t[l]=new Date(+new Date(s)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"")}return e};l.Z=s},2069:function(e,l,s){s.r(l),s.d(l,{default:function(){return h}});var t=s(3396),a=s(7139);const r=e=>((0,t.dD)("data-v-9e6327e4"),e=e(),(0,t.Cn)(),e),o={class:"search"},i=r((()=>(0,t._)("span",{style:{"vertical-align":"middle"}}," 添加用户 ",-1))),d={class:"dialog-footer"},u={class:"dialog-footer"},n={class:"dialog-footer"};function m(e,l,s,r,m,p){const c=(0,t.up)("el-breadcrumb-item"),g=(0,t.up)("el-breadcrumb"),f=(0,t.up)("Search"),h=(0,t.up)("el-icon"),w=(0,t.up)("el-button"),b=(0,t.up)("el-input"),W=(0,t.up)("Plus"),_=(0,t.up)("el-row"),V=(0,t.up)("el-table-column"),y=(0,t.up)("CircleCheck"),C=(0,t.up)("CircleClose"),U=(0,t.up)("Edit"),k=(0,t.up)("el-tooltip"),D=(0,t.up)("Delete"),$=(0,t.up)("Setting"),v=(0,t.up)("el-table"),R=(0,t.up)("el-pagination"),I=(0,t.up)("el-card"),F=(0,t.up)("el-form-item"),T=(0,t.up)("el-form"),S=(0,t.up)("el-dialog"),q=(0,t.up)("el-option"),x=(0,t.up)("el-select");return(0,t.wg)(),(0,t.iD)("div",null,[(0,t.Wm)(g,{separator:"/"},{default:(0,t.w5)((()=>[(0,t.Wm)(c,{to:{path:"/home"}},{default:(0,t.w5)((()=>[(0,t.Uk)("首页")])),_:1}),(0,t.Wm)(c,null,{default:(0,t.w5)((()=>[(0,t.Uk)("用户管理")])),_:1})])),_:1}),(0,t.Wm)(I,{class:"box-card"},{default:(0,t.w5)((()=>[(0,t.Wm)(_,null,{default:(0,t.w5)((()=>[(0,t._)("div",o,[(0,t.Wm)(b,{modelValue:m.searchStr,"onUpdate:modelValue":l[0]||(l[0]=e=>m.searchStr=e),modelModifiers:{trim:!0},placeholder:"请输入搜索内容",class:"input-with-select",width:"200px",onBlur:p.userinfoAll},{append:(0,t.w5)((()=>[(0,t.Wm)(w,{onClick:p.userinfoSearch},{default:(0,t.w5)((()=>[(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t.Wm)(f)])),_:1})])),_:1},8,["onClick"])])),_:1},8,["modelValue","onBlur"])]),(0,t.Wm)(w,{type:"primary",onClick:l[1]||(l[1]=e=>m.addDialogVisible=!0)},{default:(0,t.w5)((()=>[(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t.Wm)(W)])),_:1}),i])),_:1})])),_:1}),(0,t.Wm)(v,{data:m.userlist,style:{width:"100%"},border:"",stripe:""},{default:(0,t.w5)((()=>[(0,t.Wm)(V,{type:"index",label:"#"}),(0,t.Wm)(V,{prop:"userName",label:"用户名",width:"180"}),(0,t.Wm)(V,{prop:"userType",label:"类别",width:"100"}),(0,t.Wm)(V,{prop:"state",label:"状态",width:"80"},{default:(0,t.w5)((e=>[(0,t._)("div",null,[1==e.row.state?((0,t.wg)(),(0,t.j4)(h,{key:0,style:{color:"#67c23a"}},{default:(0,t.w5)((()=>[(0,t.Wm)(y)])),_:1})):((0,t.wg)(),(0,t.j4)(h,{key:1,style:{color:"#f56c6c"}},{default:(0,t.w5)((()=>[(0,t.Wm)(C)])),_:1}))])])),_:1}),(0,t.Wm)(V,{prop:"email",label:"邮箱",width:"175"}),(0,t.Wm)(V,{prop:"createTime",label:"注册时间",width:"180"}),(0,t.Wm)(V,{label:"操作"},{default:(0,t.w5)((e=>[(0,t.Wm)(k,{content:"修改用户",placement:"top"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{type:"primary",onClick:l=>p.showEditDialog(e.row.id)},{default:(0,t.w5)((()=>[(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t.Wm)(U)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),(0,t.Wm)(k,{content:"删除用户",placement:"top"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{type:"danger",onClick:l=>p.removeUser(e.row.id)},{default:(0,t.w5)((()=>[(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t.Wm)(D)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024),(0,t.Wm)(k,{content:"分配角色",placement:"top"},{default:(0,t.w5)((()=>[(0,t.Wm)(w,{type:"warning",onClick:l=>p.showAssignRole(e.row)},{default:(0,t.w5)((()=>[(0,t.Wm)(h,null,{default:(0,t.w5)((()=>[(0,t.Wm)($)])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"]),(0,t.Wm)(R,{onSizeChange:p.handleSizeChange,onCurrentChange:p.handleCurrentChange,"current-page":m.queryInfo.current,"page-sizes":[1,2,5,10,20,50],"page-size":m.queryInfo.size,layout:"total, sizes, prev, pager, next, jumper",total:m.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])),_:1}),(0,t.Wm)(S,{modelValue:m.addDialogVisible,"onUpdate:modelValue":l[8]||(l[8]=e=>m.addDialogVisible=e),title:"添加新用户",width:"40%",onClose:p.addDialogClosed},{footer:(0,t.w5)((()=>[(0,t._)("span",d,[(0,t.Wm)(w,{onClick:l[7]||(l[7]=e=>m.addDialogVisible=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(w,{type:"primary",onClick:p.addUserInfo},{default:(0,t.w5)((()=>[(0,t.Uk)(" 确定 ")])),_:1},8,["onClick"])])])),default:(0,t.w5)((()=>[(0,t.Wm)(T,{ref:"addFormRef",model:m.userinfo,rules:m.addFormRules,"label-width":"80px"},{default:(0,t.w5)((()=>[(0,t.Wm)(F,{label:"id"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{modelValue:m.userinfo.id,"onUpdate:modelValue":l[2]||(l[2]=e=>m.userinfo.id=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(F,{label:"用户名",prop:"userName"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{modelValue:m.userinfo.userName,"onUpdate:modelValue":l[3]||(l[3]=e=>m.userinfo.userName=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(F,{label:"邮箱",prop:"email"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{modelValue:m.userinfo.email,"onUpdate:modelValue":l[4]||(l[4]=e=>m.userinfo.email=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(F,{label:"密码",prop:"password"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{modelValue:m.userinfo.password,"onUpdate:modelValue":l[5]||(l[5]=e=>m.userinfo.password=e),"show-password":""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(F,{label:"类别",prop:"userType"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{modelValue:m.userinfo.userType,"onUpdate:modelValue":l[6]||(l[6]=e=>m.userinfo.userType=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"]),(0,t.Wm)(S,{modelValue:m.editDialogVisible,"onUpdate:modelValue":l[14]||(l[14]=e=>m.editDialogVisible=e),title:"修改用户信息",width:"40%",onClose:p.editDialogClosed},{footer:(0,t.w5)((()=>[(0,t._)("span",u,[(0,t.Wm)(w,{onClick:l[13]||(l[13]=e=>m.editDialogVisible=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(w,{type:"primary",onClick:p.editUserInfo},{default:(0,t.w5)((()=>[(0,t.Uk)(" 确定 ")])),_:1},8,["onClick"])])])),default:(0,t.w5)((()=>[(0,t.Wm)(T,{ref:"editFormRef",model:m.editForm,rules:m.editFormRules,"label-width":"80px"},{default:(0,t.w5)((()=>[(0,t.Wm)(F,{label:"用户名",prop:"userName"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{modelValue:m.editForm.userName,"onUpdate:modelValue":l[9]||(l[9]=e=>m.editForm.userName=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(F,{label:"邮箱",prop:"email"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{modelValue:m.editForm.email,"onUpdate:modelValue":l[10]||(l[10]=e=>m.editForm.email=e)},null,8,["modelValue"])])),_:1}),(0,t.Wm)(F,{label:"密码",prop:"password"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{modelValue:m.editForm.password,"onUpdate:modelValue":l[11]||(l[11]=e=>m.editForm.password=e),"show-password":""},null,8,["modelValue"])])),_:1}),(0,t.Wm)(F,{label:"类别",prop:"userType"},{default:(0,t.w5)((()=>[(0,t.Wm)(b,{modelValue:m.editForm.userType,"onUpdate:modelValue":l[12]||(l[12]=e=>m.editForm.userType=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","onClose"]),(0,t.Wm)(S,{modelValue:m.roleDialogVisible,"onUpdate:modelValue":l[17]||(l[17]=e=>m.roleDialogVisible=e),onClose:p.roleDialogClosed,title:"分配角色",width:"40%"},{footer:(0,t.w5)((()=>[(0,t._)("span",n,[(0,t.Wm)(w,{onClick:l[16]||(l[16]=e=>m.roleDialogVisible=!1)},{default:(0,t.w5)((()=>[(0,t.Uk)("取消")])),_:1}),(0,t.Wm)(w,{type:"primary",onClick:p.assignmentRole},{default:(0,t.w5)((()=>[(0,t.Uk)(" 确定 ")])),_:1},8,["onClick"])])])),default:(0,t.w5)((()=>[(0,t._)("div",null,[(0,t._)("p",null,"当前用户："+(0,a.zw)(this.assignRole_userinfo.userName),1),(0,t._)("p",null," 当前用户类别："+(0,a.zw)(this.assignRole_userinfo.userType?this.assignRole_userinfo.userType:"无"),1)]),(0,t.Wm)(x,{modelValue:m.selectRoleId,"onUpdate:modelValue":l[15]||(l[15]=e=>m.selectRoleId=e),placeholder:"请选择角色"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(m.roleList,(e=>((0,t.wg)(),(0,t.j4)(q,{key:e.id,label:e.description,value:e.id,disabled:!e.status},null,8,["label","value","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["modelValue","onClose"])])}var p=s(1166),c={data(){var e=(e,l,s)=>{var t=/^[0-9a-zA-Z_]{3,16}$/;if(!t.test(l))return s(new Error("请输入合法用户名"));s()},l=(e,l,s)=>{var t=/^学生|教师|教辅|管理员$/;if(!t.test(l))return s(new Error("类别分为学生,教师,教辅,管理员"));s()},s=(e,l,s)=>{var t=/^[0-9a-zA-Z]{6,16}$/;if(!t.test(l))return s(new Error("请输入合法密码"));s()};return{searchStr:"",queryInfo:{colums:[],current:1,size:20},userlist:[],roleList:[],selectRoleId:"",total:0,addDialogVisible:!1,editDialogVisible:!1,roleDialogVisible:!1,userinfo:{binding:0,createTime:"",deleted:0,email:"",id:0,mobile:"",password:"",state:1,token:"",updateTime:"",userName:"",userType:""},assignRole_userinfo:{},addFormRules:{userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:16,message:"用户名的长度为3-16位",trigger:"blur"},{validator:e,trigger:"blur"}],userType:[{required:!0,message:"请输入类别",trigger:"blur"},{validator:l,trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,max:16,message:"密码的长度为8-16位",trigger:"blur"},{validator:s,trigger:"blur"}]},editForm:{},editFormRules:{userName:[{required:!1,message:"请输入用户名",trigger:"blur"},{min:3,max:16,message:"用户名的长度为3-16位",trigger:"blur"},{validator:e,trigger:"blur"}],email:[{required:!1,message:"请输入邮箱",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,max:16,message:"密码的长度为8-16位",trigger:"blur"},{validator:s,trigger:"blur"}],userType:[{required:!1,message:"请输入类别",trigger:"blur"},{validator:l,trigger:"blur"}]}}},created(){this.getUserList()},methods:{async getUserList(){const{data:e}=await this.$http.post("/api/userinfo/page",this.queryInfo);if(console.log(e),!e.success)return this.$message.error("获取用户列表信息失败!");const l=e.data.page;(0,p.Z)(l.records,"createTime"),this.userlist=l.records,this.total=l.total},handleSizeChange(e){console.log(e),this.queryInfo.size=e,this.getUserList()},handleCurrentChange(e){this.queryInfo.current=e,this.getUserList()},addDialogClosed(){this.$refs.addFormRef.resetFields()},editDialogClosed(){this.$refs.editFormRef.resetFields()},async showEditDialog(e){const{data:l}=await this.$http.get("/api/userinfo/one",{params:{id:e}});if(console.log(e),!l.success)return this.$message.error("查询用户信息失败!");console.log(l.data.userinfo),this.editForm=l.data.userinfo,this.editDialogVisible=!0},addUserInfo(){this.$refs.addFormRef.validate((async e=>{if(!e)return!1;const{data:l}=await this.$http.get("/api/userinfo/all");if(console.log(l),!l.success)return this.$message.error("获取用户列表信息失败!");const s=l.data.userinfos.findIndex((e=>e.id==this.userinfo.id||e.userName==this.userinfo.userName));if(console.log(s),-1!=s)return this.$message.error("用户id重复或用户名重复");const{data:t}=await this.$http.post("/api/userinfo/add",this.userinfo);if(console.log(t),!t.success)return this.$message.error("添加用户信息失败！");this.addDialogVisible=!1,this.getUserList(),this.$message.success("添加用户信息成功！")}))},editUserInfo(){this.$refs.editFormRef.validate((async e=>{if(!e)return!1;const{data:l}=await this.$http.post("/api/userinfo/edit",this.editForm);if(!l.success)return this.$message.error("修改用户信息失败！");this.editDialogVisible=!1,this.getUserList(),this.$message.success("修改用户信息成功！")}))},async removeUser(e){const l=await this.$confirm("是否永久删除该用户?","删除用户",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((e=>e));if("confirm"!==l)return this.$message.info("取消删除");const{data:s}=await this.$http.get("/api/userinfo/delete",{params:{id:e}});if(console.log(s),!s.success)return this.$message.error(s.msg);this.getUserList(),this.$message.success(s.msg)},async showAssignRole(e){this.assignRole_userinfo=e;const{data:l}=await this.$http.get("/api/role/all");if(!l.success)return this.$message.error("获取角色列表失败!");const s=l.data.roles;this.roleList=s,console.log(this.roleList);const{data:t}=await this.$http.get("/api/userRole/getRoleIdsByUserId",{params:{userId:e.id}});console.log(t),t.success&&(console.log(typeof t.data.roleIds),this.selectRoleId=Number(t.data.roleIds)),this.roleDialogVisible=!0},async assignmentRole(){const{data:e}=await this.$http.post("/api/userRole/saveOrUpdate",{createTime:"",id:0,roleIds:this.selectRoleId,updateTime:"",userId:this.assignRole_userinfo.id});if(!e.success)return this.$message.error("用户分配角色失败!");console.log(e),this.$message.success("分配角色成功"),this.roleDialogVisible=!1},roleDialogClosed(){this.selectRoleId=""},async userinfoSearch(){const{data:e}=await this.$http.get("/api/userinfo/one",{params:{id:this.searchStr}});if(console.log(e),!e.success)return this.$message.error("查询用户信息失败，用户不存在!");console.log(this.userlist,e.data),this.userlist=[e.data.userinfo]},userinfoAll(){console.log(this.searchStr),this.searchStr||this.getUserList()}}},g=s(89);const f=(0,g.Z)(c,[["render",m],["__scopeId","data-v-9e6327e4"]]);var h=f}}]);
//# sourceMappingURL=69.899b3ad0.js.map